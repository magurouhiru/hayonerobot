# ãƒœãƒƒãƒˆä»•æ§˜æ›¸

## æ¦‚è¦

hayonerobotã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¥½ã¿ã«åˆã‚ã›ã¦ç•°ãªã‚‹æ€§æ ¼ã®ãƒœãƒƒãƒˆã‚’é¸æŠã§ãã¾ã™ã€‚å„ãƒœãƒƒãƒˆã¯ç‹¬è‡ªã®å‚¬ä¿ƒã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ã‚¿ã‚¤ãƒ«ã€æŒ¯ã‚‹èˆã„ã‚’æŒã¡ã¾ã™ã€‚

## ãƒœãƒƒãƒˆã®ç¨®é¡

### 1. ğŸ¤– ãƒœãƒƒãƒˆ(æ©Ÿæ¢°ã‚¿ã‚¤ãƒ—) - `BotType::Robot`

#### æ€§æ ¼ãƒ»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ
æ©Ÿæ¢°çš„ã§æ­£ç¢ºã€æ„Ÿæƒ…ã‚’æŒãŸãªã„ãƒ­ãƒœãƒƒãƒˆã®ã‚ˆã†ãªå­˜åœ¨ã€‚è¦å‰‡æ­£ã—ãã€äºˆæ¸¬å¯èƒ½ãªå‹•ä½œã‚’ã—ã¾ã™ã€‚

#### å‚¬ä¿ƒã‚¿ã‚¤ãƒŸãƒ³ã‚°
- **åŸºæœ¬é–“éš”**: 10åˆ†ãŠã(å›ºå®š)
- **é–‹å§‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: è¨­å®šæ™‚åˆ»ã‚’éããŸç¬é–“
- **ãƒ‘ã‚¿ãƒ¼ãƒ³**: å®Œå…¨ã«è¦å‰‡çš„

```
ä¾‹: å°±å¯æ™‚åˆ»ãŒ23:00ã®å ´åˆ
23:00 â†’ 1å›ç›®ã®é€šçŸ¥
23:10 â†’ 2å›ç›®ã®é€šçŸ¥
23:20 â†’ 3å›ç›®ã®é€šçŸ¥
23:30 â†’ 4å›ç›®ã®é€šçŸ¥
...
```

#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ã‚¿ã‚¤ãƒ«
- **ãƒˆãƒ¼ãƒ³**: å›ºã‚ã€æ•¬èªèª¿
- **ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³**: ãªã—(åŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¹°ã‚Šè¿”ã™)
- **é•·ã•**: çŸ­ãç°¡æ½”

#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹

```rust
const ROBOT_MESSAGES: &[&str] = &[
    "è¨­å®šæ™‚åˆ»ã‚’éãã¦ã„ã¾ã™ã€‚å°±å¯ã—ã¦ãã ã•ã„ã€‚",
    "å°±å¯æ™‚åˆ»ã§ã™ã€‚é€Ÿã‚„ã‹ã«å°±å¯ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚",
    "æŒ‡å®šæ™‚åˆ»ã‚’è¶…éã—ã¾ã—ãŸã€‚å°±å¯ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚",
];
```

**å®Ÿéš›ã®ä½¿ç”¨ä¾‹:**
- 1å›ç›®: "è¨­å®šæ™‚åˆ»ã‚’éãã¦ã„ã¾ã™ã€‚å°±å¯ã—ã¦ãã ã•ã„ã€‚"
- 2å›ç›®: "è¨­å®šæ™‚åˆ»ã‚’éãã¦ã„ã¾ã™ã€‚å°±å¯ã—ã¦ãã ã•ã„ã€‚"
- 3å›ç›®: "è¨­å®šæ™‚åˆ»ã‚’éãã¦ã„ã¾ã™ã€‚å°±å¯ã—ã¦ãã ã•ã„ã€‚"
- *(åŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¹°ã‚Šè¿”ã™)*

#### é€šçŸ¥æ–¹æ³•
- **éŸ³**: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ“ãƒ¼ãƒ—éŸ³
- **ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**(Android): çŸ­ã„1å›ã®ã¿
- **é€šçŸ¥ã®å„ªå…ˆåº¦**: æ¨™æº–

#### ã“ã‚“ãªäººã«ãŠã™ã™ã‚
- è¦å‰‡æ­£ã—ã„ç”Ÿæ´»ã‚’é€ã‚ŠãŸã„äºº
- äºˆæ¸¬å¯èƒ½ãªé€šçŸ¥ãŒå¥½ããªäºº
- ã‚·ãƒ³ãƒ—ãƒ«ã§é‚ªé­”ã«ãªã‚‰ãªã„é€šçŸ¥ã‚’æ±‚ã‚ã‚‹äºº

---

### 2. ğŸ‘© ãŠã‹ã‚“(æ¯è¦ªã‚¿ã‚¤ãƒ—) - `BotType::Okan`

#### æ€§æ ¼ãƒ»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ
å…ƒæ°—ã§ä¸–è©±ç„¼ããªæ¯è¦ªã®ã‚ˆã†ãªå­˜åœ¨ã€‚è¦ªã—ã¿ã‚„ã™ãã€æ™‚ã«ã¯å³ã—ãã€æ™‚ã«ã¯å„ªã—ãæ¥ã—ã¾ã™ã€‚

#### å‚¬ä¿ƒã‚¿ã‚¤ãƒŸãƒ³ã‚°
- **åŸºæœ¬é–“éš”**: 5ã€œ30åˆ†ãŠã(ãƒ©ãƒ³ãƒ€ãƒ )
- **é–‹å§‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: è¨­å®šæ™‚åˆ»ã‚’éãã¦ã‹ã‚‰0ã€œ5åˆ†å¾Œ(ãƒ©ãƒ³ãƒ€ãƒ )
- **ãƒ‘ã‚¿ãƒ¼ãƒ³**: ä¸è¦å‰‡ã§äºˆæ¸¬ä¸å¯èƒ½

```
ä¾‹: å°±å¯æ™‚åˆ»ãŒ23:00ã®å ´åˆ
23:02 â†’ 1å›ç›®ã®é€šçŸ¥(2åˆ†é…ã‚Œ)
23:15 â†’ 2å›ç›®ã®é€šçŸ¥(13åˆ†å¾Œ)
23:42 â†’ 3å›ç›®ã®é€šçŸ¥(27åˆ†å¾Œ)
23:50 â†’ 4å›ç›®ã®é€šçŸ¥(8åˆ†å¾Œ)
...
```

#### ãƒ©ãƒ³ãƒ€ãƒ æ€§ã®å®Ÿè£…

```rust
use rand::Rng;

fn get_next_interval() -> Duration {
    let mut rng = rand::thread_rng();
    let minutes = rng.gen_range(5..=30);
    Duration::from_secs(minutes * 60)
}

fn get_initial_delay() -> Duration {
    let mut rng = rand::thread_rng();
    let minutes = rng.gen_range(0..=5);
    Duration::from_secs(minutes * 60)
}
```

#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ã‚¿ã‚¤ãƒ«
- **ãƒˆãƒ¼ãƒ³**: ç •ã‘ãŸæ„Ÿã˜ã€è¦ªã—ã¿ã‚„ã™ã„
- **ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³**: è±Šå¯Œ(æ¯å›ç•°ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
- **é•·ã•**: ã‚„ã‚„é•·ã‚ã€æ„Ÿæƒ…çš„

#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ†ã‚´ãƒª

##### 1. å„ªã—ã„å‚¬ä¿ƒ(1ã€œ2å›ç›®)
```rust
const OKAN_GENTLE: &[&str] = &[
    "ã‚‚ã†å¯ã‚‹æ™‚é–“ã‚„ã§ã€œã€‚æ˜æ—¥ã‚‚æ—©ã„ã‚“ã¡ã‚ƒã†ã‚“?",
    "ã­ã‡ã­ã‡ã€ãã‚ãã‚å¯ãªã‚ã‹ã‚“ã‚ˆã€‚ä½“å£Šã™ã§?",
    "å¤œæ›´ã‹ã—ã¯ãŠè‚Œã®æ•µã‚„ã§!æ—©ãå¯ãªã•ã„ã€œ",
    "ã‚‚ã†ã“ã‚“ãªæ™‚é–“!?æ—©ãå¯ã‚“ã¨æ˜æ—¥ã—ã‚“ã©ã„ã§!",
    "ã‚¹ãƒãƒ›è¦‹ã‚‹ã®ã¯ãã“ã¾ã§!ã•ã£ã•ã¨å¯ãªã•ã„!",
];
```

##### 2. å°‘ã—å¼·ã‚ã®å‚¬ä¿ƒ(3ã€œ4å›ç›®)
```rust
const OKAN_FIRM: &[&str] = &[
    "ä½•å›è¨€ã‚ã›ã‚‹ã‚“!?æ—©ãå¯ãªã•ã„!!",
    "ã„ã„åŠ æ¸›ã«ã—ãªã•ã„!ã‚‚ã†ä½•æ™‚ã‚„ã¨æ€ã£ã¦ã‚‹ã‚“!",
    "ã‚ã‚“ãŸã€æ˜æ—¥èµ·ãã‚Œã‚“ã§ã‚‚çŸ¥ã‚‰ã‚“ã§!?",
    "ãŠæ¯ã•ã‚“æ€’ã‚‹ã§!?ä»Šã™ãå¯ãªã•ã„!!",
    "ã‚‚ã†!è¨€ã†ã“ã¨èã‹ã‚“å­ã‚„ãªã...æ—©ãå¯ã¦!",
];
```

##### 3. è«¦ã‚ãƒ¢ãƒ¼ãƒ‰(5å›ç›®ä»¥é™)
```rust
const OKAN_RESIGNED: &[&str] = &[
    "ã¯ã...ã‚‚ã†çŸ¥ã‚‰ã‚“ã€‚å¥½ãã«ã—ãƒ...(ã§ã‚‚å¿ƒé…ã‚„ã§)",
    "ãŠæ¯ã•ã‚“ã‚‚ã†ç–²ã‚ŒãŸ...ã§ã‚‚ä½“ã ã‘ã¯å¤§äº‹ã«ã—ã¦ãª...",
    "ã‚ã‚“ãŸã®ã“ã¨å¿ƒé…ã§çœ ã‚Œã¸ã‚“ã‚...æ—©ãå¯ã¦ãã‚Œã‚“ã¨...",
    "ã‚‚ã†ä½•ã‚‚è¨€ã‚ã‚“...ã§ã‚‚ã€ã¡ã‚ƒã‚“ã¨å¯ã¦ãª?ç´„æŸã‚„ã§?",
];
```

#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é¸æŠãƒ­ã‚¸ãƒƒã‚¯

```rust
fn get_okan_message(notification_count: u32) -> &'static str {
    use rand::seq::SliceRandom;
    let mut rng = rand::thread_rng();
    
    match notification_count {
        1..=2 => OKAN_GENTLE.choose(&mut rng).unwrap(),
        3..=4 => OKAN_FIRM.choose(&mut rng).unwrap(),
        _ => OKAN_RESIGNED.choose(&mut rng).unwrap(),
    }
}
```

#### é€šçŸ¥æ–¹æ³•
- **éŸ³**: æ¸©ã‹ã¿ã®ã‚ã‚‹é€šçŸ¥éŸ³(ãƒãƒ£ã‚¤ãƒ ç³»)
- **ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**(Android): 
  - 1ã€œ2å›ç›®: çŸ­ã„1å›
  - 3ã€œ4å›ç›®: 2å›é€£ç¶š
  - 5å›ç›®ä»¥é™: é•·ã‚ã®1å›
- **é€šçŸ¥ã®å„ªå…ˆåº¦**: é«˜ã‚

#### ã“ã‚“ãªäººã«ãŠã™ã™ã‚
- è¦ªã—ã¿ã‚„ã™ã„é›°å›²æ°—ãŒå¥½ããªäºº
- æ¯å›é•ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§é£½ããŸããªã„äºº
- ã¡ã‚‡ã£ã¨å³ã—ã‚ã®å‚¬ä¿ƒãŒæ¬²ã—ã„äºº

---

## å…±é€šä»•æ§˜

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```rust
#[derive(Debug, Clone, PartialEq)]
pub enum BotType {
    Robot,
    Okan,
}

#[derive(Debug, Clone)]
pub struct BotConfig {
    pub bot_type: BotType,
    pub bedtime: String, // "HH:MM" format
    pub enabled: bool,
    pub sound_enabled: bool,
    pub vibration_enabled: bool, // Android only
}

#[derive(Debug, Clone)]
pub struct NotificationState {
    pub count: u32,
    pub last_notification: Option<DateTime<Local>>,
    pub next_notification: Option<DateTime<Local>>,
}
```

### é€šçŸ¥ãƒ­ã‚¸ãƒƒã‚¯

```rust
pub trait Bot {
    fn get_next_interval(&self, count: u32) -> Duration;
    fn get_message(&self, count: u32) -> String;
    fn get_vibration_pattern(&self, count: u32) -> VibrationPattern;
}

impl Bot for BotType {
    fn get_next_interval(&self, count: u32) -> Duration {
        match self {
            BotType::Robot => Duration::from_secs(10 * 60), // 10åˆ†å›ºå®š
            BotType::Okan => {
                let mut rng = rand::thread_rng();
                let minutes = rng.gen_range(5..=30);
                Duration::from_secs(minutes * 60)
            }
        }
    }
    
    fn get_message(&self, count: u32) -> String {
        match self {
            BotType::Robot => get_robot_message(),
            BotType::Okan => get_okan_message(count),
        }
    }
    
    fn get_vibration_pattern(&self, count: u32) -> VibrationPattern {
        match self {
            BotType::Robot => VibrationPattern::Short,
            BotType::Okan => match count {
                1..=2 => VibrationPattern::Short,
                3..=4 => VibrationPattern::Double,
                _ => VibrationPattern::Long,
            },
        }
    }
}
```

### è¨­å®šã®æ°¸ç¶šåŒ–

```rust
// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
pub fn save_config(config: &BotConfig) -> Result<(), Error> {
    // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®ä¿å­˜å‡¦ç†
}

pub fn load_config() -> Result<BotConfig, Error> {
    // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®èª­ã¿è¾¼ã¿å‡¦ç†
}
```

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### è¿½åŠ äºˆå®šã®ãƒœãƒƒãƒˆ

#### 3. ğŸ± ã­ã“(çŒ«ã‚¿ã‚¤ãƒ—) - `BotType::Cat`
- **æ€§æ ¼**: æ°—ã¾ãã‚Œã€ãƒ„ãƒ³ãƒ‡ãƒ¬
- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: è¶…ãƒ©ãƒ³ãƒ€ãƒ (1ã€œ60åˆ†)
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: çŸ­ãã€ãã£ã‘ãªã„

#### 4. ğŸ¤µ åŸ·äº‹(ãƒãƒˆãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—) - `BotType::Butler`
- **æ€§æ ¼**: ä¸å¯§ã€ä¸Šå“
- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: è¦å‰‡çš„ã ãŒå¾ã€…ã«é–“éš”ãŒçŸ­ããªã‚‹
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: æ•¬èªã€ä¸å¯§èª

#### 5. ğŸ‘¹ é¬¼æ•™å®˜(ã‚¹ãƒ‘ãƒ«ã‚¿ã‚¿ã‚¤ãƒ—) - `BotType::Drill`
- **æ€§æ ¼**: å³ã—ã„ã€å®¹èµ¦ãªã„
- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: çŸ­ã„é–“éš”(3ã€œ5åˆ†)
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: å‘½ä»¤å£èª¿ã€å³ã—ã‚

### æ©Ÿèƒ½æ‹¡å¼µ

- **ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬è‡ªã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ å¯èƒ½
- **éŸ³å£°èª­ã¿ä¸Šã’**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éŸ³å£°ã§èª­ã¿ä¸Šã’(TTS)
- **å­¦ç¿’æ©Ÿèƒ½**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå¿œãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’ã—ã¦æœ€é©åŒ–
- **æ™‚é–“å¸¯åˆ¥è¨­å®š**: å¹³æ—¥ã¨ä¼‘æ—¥ã§ç•°ãªã‚‹ãƒœãƒƒãƒˆã‚’ä½¿ç”¨

## ãƒ†ã‚¹ãƒˆä»•æ§˜

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```rust
#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_robot_interval_is_constant() {
        let bot = BotType::Robot;
        assert_eq!(bot.get_next_interval(1), Duration::from_secs(600));
        assert_eq!(bot.get_next_interval(10), Duration::from_secs(600));
    }
    
    #[test]
    fn test_okan_interval_is_random() {
        let bot = BotType::Okan;
        let interval1 = bot.get_next_interval(1);
        let interval2 = bot.get_next_interval(2);
        // ãƒ©ãƒ³ãƒ€ãƒ ãªã®ã§æ¯å›ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
        assert!(interval1.as_secs() >= 300 && interval1.as_secs() <= 1800);
    }
    
    #[test]
    fn test_okan_message_changes_by_count() {
        let bot = BotType::Okan;
        let msg1 = bot.get_message(1);
        let msg5 = bot.get_message(5);
        // ã‚«ã‚¦ãƒ³ãƒˆã«ã‚ˆã£ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒˆãƒ¼ãƒ³ãŒå¤‰ã‚ã‚‹
        assert_ne!(msg1, msg5);
    }
}
```

### çµ±åˆãƒ†ã‚¹ãƒˆ

- å„ãƒœãƒƒãƒˆã‚¿ã‚¤ãƒ—ã§ã®é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ç¢ºèª
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ©ãƒ³ãƒ€ãƒ æ€§ã®ç¢ºèª
- è¨­å®šã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ã®ç¢ºèª
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®é€šçŸ¥æ©Ÿèƒ½ã®ç¢ºèª

## å‚è€ƒè³‡æ–™

- [architecture.md](./architecture.md) - å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- [README.md](../README.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
